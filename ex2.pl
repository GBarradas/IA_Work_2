tamanho0tabuleiro(9). %(9x9)

%%%% v(p(COLUNA, LINHA), DOMINIO, VALOR)
estado0inicial(e([v(p(0,0), [1,2,3,4,5,6,7,8,9], 0), v(p(1,0), [1,2,3,4,5,6,7,8,9], 1), v(p(2,0), [1,2,3,4,5,6,7,8,9], 0), v(p(3,0), [1,2,3,4,5,6,7,8,9], 0), 
            v(p(4,0), [1,2,3,4,5,6,7,8,9], 0), v(p(5,0), [1,2,3,4,5,6,7,8,9], 8), v(p(6,0), [1,2,3,4,5,6,7,8,9], 0), v(p(7,0), [1,2,3,4,5,6,7,8,9], 7),
            v(p(8,0), [1,2,3,4,5,6,7,8,9], 3),

            v(p(0,1), [1,2,3,4,5,6,7,8,9], 0), v(p(1,1), [1,2,3,4,5,6,7,8,9], 0), v(p(2,1), [1,2,3,4,5,6,7,8,9], 0), v(p(3,1), [1,2,3,4,5,6,7,8,9], 5),
            v(p(4,1), [1,2,3,4,5,6,7,8,9], 0), v(p(5,1), [1,2,3,4,5,6,7,8,9], 9), v(p(6,1), [1,2,3,4,5,6,7,8,9], 0), v(p(7,1), [1,2,3,4,5,6,7,8,9], 0),
            v(p(8,1), [1,2,3,4,5,6,7,8,9], 0),

            v(p(0,2), [1,2,3,4,5,6,7,8,9], 7), v(p(1,2), [1,2,3,4,5,6,7,8,9], 0), v(p(2,2), [1,2,3,4,5,6,7,8,9], 0), v(p(3,2), [1,2,3,4,5,6,7,8,9], 0),
            v(p(4,2), [1,2,3,4,5,6,7,8,9], 0), v(p(5,2), [1,2,3,4,5,6,7,8,9], 0), v(p(6,2), [1,2,3,4,5,6,7,8,9], 9), v(p(7,2), [1,2,3,4,5,6,7,8,9], 0),
            v(p(8,2), [1,2,3,4,5,6,7,8,9], 4),

            v(p(0,3), [1,2,3,4,5,6,7,8,9], 0), v(p(1,3), [1,2,3,4,5,6,7,8,9], 0), v(p(2,3), [1,2,3,4,5,6,7,8,9], 0), v(p(3,3), [1,2,3,4,5,6,7,8,9], 0),
            v(p(4,3), [1,2,3,4,5,6,7,8,9], 0), v(p(5,3), [1,2,3,4,5,6,7,8,9], 4), v(p(6,3), [1,2,3,4,5,6,7,8,9], 0), v(p(7,3), [1,2,3,4,5,6,7,8,9], 0),
            v(p(8,3), [1,2,3,4,5,6,7,8,9], 0),

            v(p(0,4), [1,2,3,4,5,6,7,8,9], 0), v(p(1,4), [1,2,3,4,5,6,7,8,9], 0), v(p(2,4), [1,2,3,4,5,6,7,8,9], 0), v(p(3,4), [1,2,3,4,5,6,7,8,9], 0),
            v(p(4,4), [1,2,3,4,5,6,7,8,9], 3), v(p(5,4), [1,2,3,4,5,6,7,8,9], 5), v(p(6,4), [1,2,3,4,5,6,7,8,9], 0), v(p(7,4), [1,2,3,4,5,6,7,8,9], 1),
            v(p(8,4), [1,2,3,4,5,6,7,8,9], 8),

            v(p(0,5), [1,2,3,4,5,6,7,8,9], 8), v(p(1,5), [1,2,3,4,5,6,7,8,9], 0), v(p(2,5), [1,2,3,4,5,6,7,8,9], 0), v(p(3,5), [1,2,3,4,5,6,7,8,9], 9),
            v(p(4,5), [1,2,3,4,5,6,7,8,9], 0), v(p(5,5), [1,2,3,4,5,6,7,8,9], 0), v(p(6,5), [1,2,3,4,5,6,7,8,9], 0), v(p(7,5), [1,2,3,4,5,6,7,8,9], 0),
            v(p(8,5), [1,2,3,4,5,6,7,8,9], 0),v(p(0,8), [1,2,3,4,5,6,7,8,9], 0)

            v(p(0,6), [1,2,3,4,5,6,7,8,9], 0), v(p(1,6), [1,2,3,4,5,6,7,8,9], 0), v(p(2,6), [1,2,3,4,5,6,7,8,9], 0), v(p(3,6), [1,2,3,4,5,6,7,8,9], 7),
            v(p(4,6), [1,2,3,4,5,6,7,8,9], 0), v(p(5,6), [1,2,3,4,5,6,7,8,9], 0), v(p(6,6), [1,2,3,4,5,6,7,8,9], 0), v(p(7,6), [1,2,3,4,5,6,7,8,9], 0),
            v(p(8,6), [1,2,3,4,5,6,7,8,9], 0),

            v(p(0,7), [1,2,3,4,5,6,7,8,9], 2), v(p(1,7), [1,2,3,4,5,6,7,8,9], 6), v(p(2,7), [1,2,3,4,5,6,7,8,9], 0), v(p(3,7), [1,2,3,4,5,6,7,8,9], 0),
            v(p(4,7), [1,2,3,4,5,6,7,8,9], 4), v(p(5,7), [1,2,3,4,5,6,7,8,9], 0), v(p(6,7), [1,2,3,4,5,6,7,8,9], 0), v(p(7,7), [1,2,3,4,5,6,7,8,9], 3),
            v(p(8,7), [1,2,3,4,5,6,7,8,9], 0),

            v(p(0,8), [1,2,3,4,5,6,7,8,9], 0), v(p(1,8), [1,2,3,4,5,6,7,8,9], 0), v(p(2,8), [1,2,3,4,5,6,7,8,9], 5), v(p(3,8), [1,2,3,4,5,6,7,8,9], 0),
            v(p(4,8), [1,2,3,4,5,6,7,8,9], 0), v(p(5,8), [1,2,3,4,5,6,7,8,9], 3), v(p(6,8), [1,2,3,4,5,6,7,8,9], 0), v(p(7,8), [1,2,3,4,5,6,7,8,9], 0),
            v(p(8,8), [1,2,3,4,5,6,7,8,9], 0)
            ])).

% Tabuleiro resultante do estado inicial
/*
-------------------------------------
|   | 1 |   |   |   | 8 |   | 7 | 3 |
|---|---|---|---|---|---|---|---|---|
|   |   |   | 5 |   | 9 |   |   |   |
|---|---|---|---|---|---|---|---|---|
| 7 |   |   |   |   |   | 9 |   | 4 |
|---|---|---|---|---|---|---|---|---|
|   |   |   |   |   | 4 |   |   |   |
|---|---|---|---|---|---|---|---|---|
|   |   |   |   | 3 | 5 |   | 1 | 8 |
|---|---|---|---|---|---|---|---|---|
| 8 |   |   | 9 |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
|   |   |   | 7 |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
| 2 | 6 |   |   | 4 |   |   | 3 |   |
|---|---|---|---|---|---|---|---|---|
|   |   | 5 |   |   | 3 |   |   |   |
-------------------------------------
*/

  % verifica se os elementos numa lista sao todos diferentes
  todos_diferentes([]).
  todos_diferentes([X|R]):-
    (igual(X,0) ; \+ member(X,R)), todos_diferentes(R).

igual(X,X).
%%%% restrições

verificar_restricoes(E) :- 
    verificar_linhas(E), 
    verificar_colunas(E),
    verificar_quadrantes(E).

verificar_linhas(e([v(p(X,Y), D, V)|R])) :-
    findall(V1, member(v(p(_,Y), _, V1), R), L),
    todos_diferentes([V|L]).

verificar_colunas(e([v(p(X,Y), D, V)|R])) :-
    findall(V1, member(v(p(X,_), _, V1), R), L),
    todos_diferentes([V|L]).

verificar_quadrantes(e(L)) :-
    aux_quadrantes


aux_quadrantes(L, X, Y, Y2, Q) :-
    Y = Y2, X1 is X+2,
    adicionar_quadrante(L, X, Y, X1, Q).
aux_quadrantes(L, X, Y, Y2, Q) :-
    Y < Y2, Y1 is Y+1,
    X1 is X+2,
    adicionar_quadrante(L, X, Y, X1, L1),
    append(L1, L2, Q),
    aux_quadrantes(L, X, Y1, Y2, L2).

adicionar_quadrante(L, X, Y, X2, []) :-
    X = X2,
    \+member(v(p(X,Y), _, _), L).
adicionar_quadrante(L, X, Y, X2, [V]) :-
    X = X2,
    member(v(p(X,Y), _, V), L).
adicionar_quadrante(L, X, Y, X2, L2) :-
    X < X2, X1 is X+1,
    \+member(v(p(X,Y), _, _), L),
    adicionar_quadrante(L, X1, Y, X2, L2).
adicionar_quadrante(L, X, Y, X2, [V|L2]) :-
    X < X2,
    member(v(p(X,Y), _, V), L),
    X1 is X+1,
    adicionar_quadrante(L, X1, Y, X2, L2).

  % função de print
  esc(L):-sort(L, L1), esc_a(L1),nl.
  esc_a(L):- tamanho_tabuleiro(S), esc_l(L, 1, S).
  
  esc_l([H], S, S):-
    H = v(_,_,X), write(X),nl.
  
  esc_l([H|T], S, S):-
    H = v(_,_,X), write(X), nl,
    esc_l(T, 1, S).
  
  esc_l([H|T], I, S):- 
    I<S, I2 is I+1,
    H = v(_,_,X), write(X),write(' . '),
    esc_l(T, I2, S).