

estado_inicial(e([v(p(1, 1), [1,2,3,4,5,6,7,8,9], _), v(p(1, 3), [1,2,3,4,5,6,7,8,9], _), v(p(1, 4), [1,2,3,4,5,6,7,8,9], _), v(p(1, 5), [1,2,3,4,5,6,7,8,9], _), v(p(1, 7), [1,2,3,4,5,6,7,8,9], _),
                v(p(2, 1), [1,2,3,4,5,6,7,8,9], _), v(p(2, 2), [1,2,3,4,5,6,7,8,9], _), v(p(2, 3), [1,2,3,4,5,6,7,8,9], _), v(p(2, 5), [1,2,3,4,5,6,7,8,9], _), v(p(2, 7), [1,2,3,4,5,6,7,8,9], _), v(p(2, 8), [1,2,3,4,5,6,7,8,9], _), v(p(2, 9), [1,2,3,4,5,6,7,8,9], _),
                v(p(3, 2), [1,2,3,4,5,6,7,8,9], _), v(p(3, 3), [1,2,3,4,5,6,7,8,9], _), v(p(3, 4), [1,2,3,4,5,6,7,8,9], _), v(p(3, 5), [1,2,3,4,5,6,7,8,9], _), v(p(3, 6), [1,2,3,4,5,6,7,8,9], _), v(p(3, 8), [1,2,3,4,5,6,7,8,9], _),
                v(p(4, 1), [1,2,3,4,5,6,7,8,9], _), v(p(4, 2), [1,2,3,4,5,6,7,8,9], _), v(p(4, 3), [1,2,3,4,5,6,7,8,9], _), v(p(4, 4), [1,2,3,4,5,6,7,8,9], _), v(p(4, 5), [1,2,3,4,5,6,7,8,9], _), v(p(4, 7), [1,2,3,4,5,6,7,8,9], _), v(p(4, 8), [1,2,3,4,5,6,7,8,9], _), v(p(4, 9), [1,2,3,4,5,6,7,8,9], _),
                v(p(5, 1), [1,2,3,4,5,6,7,8,9], _), v(p(5, 2), [1,2,3,4,5,6,7,8,9], _), v(p(5, 3), [1,2,3,4,5,6,7,8,9], _), v(p(5, 4), [1,2,3,4,5,6,7,8,9], _), v(p(5, 7), [1,2,3,4,5,6,7,8,9], _), 
                v(p(6, 2), [1,2,3,4,5,6,7,8,9], _), v(p(6, 3), [1,2,3,4,5,6,7,8,9], _), v(p(6, 5), [1,2,3,4,5,6,7,8,9], _), v(p(6, 6), [1,2,3,4,5,6,7,8,9], _), v(p(6, 7), [1,2,3,4,5,6,7,8,9], _), v(p(6, 8), [1,2,3,4,5,6,7,8,9], _), v(p(6, 9), [1,2,3,4,5,6,7,8,9], _),
                v(p(7, 1), [1,2,3,4,5,6,7,8,9], _), v(p(7, 2), [1,2,3,4,5,6,7,8,9], _), v(p(7, 3), [1,2,3,4,5,6,7,8,9], _), v(p(7, 5), [1,2,3,4,5,6,7,8,9], _), v(p(7, 6), [1,2,3,4,5,6,7,8,9], _), v(p(7, 7), [1,2,3,4,5,6,7,8,9], _), v(p(7, 8), [1,2,3,4,5,6,7,8,9], _), v(p(7, 9), [1,2,3,4,5,6,7,8,9], _),
                v(p(8, 3), [1,2,3,4,5,6,7,8,9], _), v(p(8, 4), [1,2,3,4,5,6,7,8,9], _), v(p(8, 6), [1,2,3,4,5,6,7,8,9], _), v(p(8, 7), [1,2,3,4,5,6,7,8,9], _), v(p(8, 9), [1,2,3,4,5,6,7,8,9], _), 
                v(p(9, 1), [1,2,3,4,5,6,7,8,9], _), v(p(9, 2), [1,2,3,4,5,6,7,8,9], _), v(p(9, 4), [1,2,3,4,5,6,7,8,9], _), v(p(9, 5), [1,2,3,4,5,6,7,8,9], _), v(p(9, 7), [1,2,3,4,5,6,7,8,9], _), v(p(9, 8), [1,2,3,4,5,6,7,8,9], _), v(p(9, 9), [1,2,3,4,5,6,7,8,9], _)],
               [v(p(1, 2), [1,2,3,4,5,6,7,8,9], 1), v(p(1, 6), [1,2,3,4,5,6,7,8,9], 8), v(p(1, 8), [1,2,3,4,5,6,7,8,9], 7), v(p(1, 9), [1,2,3,4,5,6,7,8,9], 3),
                v(p(2, 4), [1,2,3,4,5,6,7,8,9], 5), v(p(2, 6), [1,2,3,4,5,6,7,8,9], 9),
                v(p(3, 1), [1,2,3,4,5,6,7,8,9], 7), v(p(3, 7), [1,2,3,4,5,6,7,8,9], 9), v(p(3, 9), [1,2,3,4,5,6,7,8,9], 4),
                v(p(4, 6), [1,2,3,4,5,6,7,8,9], 4),
                v(p(5, 5), [1,2,3,4,5,6,7,8,9], 3), v(p(5, 6), [1,2,3,4,5,6,7,8,9], 5), v(p(5, 8), [1,2,3,4,5,6,7,8,9], 1), v(p(5, 9), [1,2,3,4,5,6,7,8,9], 8),
                v(p(6, 1), [1,2,3,4,5,6,7,8,9], 8), v(p(6, 4), [1,2,3,4,5,6,7,8,9], 9),
                v(p(7, 4), [1,2,3,4,5,6,7,8,9], 7),
                v(p(8, 1), [1,2,3,4,5,6,7,8,9], 2), v(p(8, 2), [1,2,3,4,5,6,7,8,9], 6), v(p(8, 5), [1,2,3,4,5,6,7,8,9], 4), v(p(8, 8), [1,2,3,4,5,6,7,8,9], 3),
                v(p(9, 3), [1,2,3,4,5,6,7,8,9], 5), v(p(9, 6), [1,2,3,4,5,6,7,8,9], 3)])).



%Restricoes 

verifica_restricao(E):-
    verifica_linhas(E),
    verifica_colunas(E),
    verifica_quadranterantes(E).
  
  
  verifica_linhas(e(_,[v(p(X,_), _, V)|R])):-
    findall(V1,member(v(p(X,_),_,V1),R),L),
     todos_diferentes([V|L]).
    
  verifica_colunas(e(_,[v(p(_,Y), _, V)|R])):-
    findall(V1,member(v(p(_,Y),_,V1),R),L),
    todos_diferentes([V|L]).
  
  
  verifica_quadranterantes(e(_,Afectado)) :-
    verifica_quadrante(Afectado, 1, 1, 3, Quadrante1),
    todos_diferentes(Quadrante1),
    verifica_quadrante(Afectado, 1, 4, 6, Quadrante2),
    todos_diferentes(Quadrante2),
    verifica_quadrante(Afectado, 1, 7, 9, Quadrante3),
    todos_diferentes(Quadrante3),
    verifica_quadrante(Afectado, 4, 1, 3, Quadrante4),
    todos_diferentes(Quadrante4),
    verifica_quadrante(Afectado, 4, 4, 6, Quadrante5),
    todos_diferentes(Quadrante5),
    verifica_quadrante(Afectado, 4, 7, 9, Quadrante6),
    todos_diferentes(Quadrante6),
    verifica_quadrante(Afectado, 7, 1, 3, Quadrante7),
    todos_diferentes(Quadrante7),
    verifica_quadrante(Afectado, 7, 4, 6, Quadrante8),
    todos_diferentes(Quadrante8),
    verifica_quadrante(Afectado, 7, 7, 9, Quadrante9),
    todos_diferentes(Quadrante9).
  
  
  verifica_quadrante(L, X, Y, Y2, Q) :-
    Y = Y2, X1 is X+2,
    adiciona_quadrante(L, X, Y, X1, Q).
  
  verifica_quadrante(L, X, Y, Y2, Q) :-
    Y < Y2, Y1 is Y+1,
    X1 is X+2,
    adiciona_quadrante(L, X, Y, X1, L1),
    append(L1, L2, Q),
    verifica_quadrante(L, X, Y1, Y2, L2).
  
  adiciona_quadrante(L, X, Y, X2, []) :-
    X = X2,
    \+member(v(p(X, Y), _, _), L).
  
  adiciona_quadrante(L, X, Y, X2, [V]) :-
    X = X2,
    member(v(p(X, Y), _, V), L).
  
  adiciona_quadrante(L, X, Y, X2, T) :-
    X < X2, X1 is X+1,
    \+member(v(p(X, Y), _, _), L),
    adiciona_quadrante(L, X1, Y, X2, T).
  
  adiciona_quadrante(L, X, Y, X2, [V|T]) :-
    X < X2,
    member(v(p(X, Y), _, V), L),
    X1 is X+1,
    adiciona_quadrante(L, X1, Y, X2, T).
  
  
  % verifica se os elementos numa lista sao todos diferentes
  todos_diferentes([]).
  todos_diferentes([X|R]):-
    \+ member(X,R), todos_diferentes(R).
  
  
  % função de print
  escreve(L):-sort(L, L1), escreve_a(L1),nl.
  escreve_a(L):- escreve_l(L, 1, 9).
  
  escreve_l([H], S, S):-
    H = v(_,_,X), write(X),nl.
  
  escreve_l([H|T], S, S):-
    H = v(_,_,X), write(X), nl,
    escreve_l(T, 1, S).
  
  escreve_l([H|T], I, S):- 
    I<S, I2 is I+1,
    H = v(_,_,X), write(X),write(' . '),
    escreve_l(T, I2, S).
  
  % função sucessor
  sucessor(e([v(N,D,_)|R],E),e(R,[v(N,D,V)|E])):- 
      member(V,D).
  
  
  % função BackTracking 
  back(e([],A),A).
  back(E,Solucao):- 
        sucessor(E,E1), 
        verifica_restricao(E1),
      back(E1,Solucao).
  
  
  % função forward checking
  forward(e([],A),A).
  forward(E,Solucao):- 
      sucessor(E,E1),
      verifica_restricao(E1), 
      forCheck(E1, E2),
      forward(E2, Solucao).
  
  forCheck(e(Lni,[v(N,D,V)|Li]), e(Lnii, [v(N,D,V)|Li])) :- corta(V,Lni,Lnii).
  
  corta(_,[],[]).
  corta(V,[v(N,_,_)|NaoAfectado],[v(N,_,_)|NaoAfectadoS]):-  
      corta(V, NaoAfectado, NaoAfectadoS).
  
  sudoku_b:- 
      estado_inicial(E), 
      back(E,A), 
      escreve(A).
  
  
  sudoku_f:-
    estado_inicial(E0),
    forward(E0,A), 
    escreve(A).